---
title: GitForThemeUpdate
date: 2025-06-04 23:55:13
tags: 学习笔记
---
# GitForThemeUpdate

### 起源

​	vite构建工具有**构建和资源管理**上的优势，再加上vitepress拓展的自由，我终于不用忍受hexo写作加不了图片，需要手动构建，我不会改等等问题，决定弃hexo而去，拥抱vitepress。

​	为了自定义了vitepress成为博客风格主题，写了 首页打字机、文章信息统计、侧边栏、侧边抽屉、顶部状态栏、树形大纲、标签等等杂七杂八的功能和组件，终于看起来像一个“博客”了。

### 写了这么多不能只有我一个人知道

​	于是我找到之前带我用hexo博客的同济✌[anaouse](https://anaouse.github.io/)软磨硬泡让他用上了我的主题。但其实这个主题还不完善，功能不足，而且还有bug没解决。

​	咋整才能让用主题的人能够体验到我最新写的代码呢？

### git好像有说法

​	git作为一个版本控制工具，仅仅拿来“备份”代码，好像有点浪费。而且也没人跟我协作写代码🥲。git能从远程拉去代码，这正好符合主题更新的需求。

​	只要把主题的模板写好在github仓库，用的人可以直接fork完整的模板代码和自动构建工作流。用户只需要简单的**改改模板**中的文字和图片，**上传到仓库**就会**触发工作流自动构建**，TA就能马上拥有一个静态博客网页！

​	**更新主题**和最开始使用主题其实就一点区别，就是将**除了用户自定义的内容以外**的文件和模板仓库同步就行。会用git的用户，直接让他们自己`git fetch upstream main`然后合并以下就行。

​	但我想起我刚刚开始搭个人博客时，啥都不懂，啥也不会。要是能够动动手指就能更新，动动手指就能更新和上传就好了。

​	既然如此，不如写个脚本给使用者（或者是曾经的自己）。



### 利用git更新主题

​	首先做一些准备工作。vitepress拓展性高，但我们既然已经把他包装成主题了，那么咱的目标用户就不应该是需要“进一步拓展主题”的高级玩家，而是“专注内容”的用户。因此，我直接将所有我希望用户能够自定义的内容全部集成到最外层一个文件 `site_config.ts`中，然后让用户通过`public/ `引入自己的资源，`posts/`写自己的文章。由于vite特性，文章中需要的相关资源直接放在`posts/`中，通过相对路径就能使用。比如图片、封面等等。如此，对于专注内容的用户，他只会改变上述三个文件(夹)。

​	那我们的脚本就把除了`site_config.ts` `public/ ` `posts/`外的内容完全同步上游即可。明确了目标后，先找一个大体的方向：开始更新时：

1. 保存当前指定的三个文件状态
2. 获取上游仓库,完全同步上游仓库
3. 恢复指定的三个文件

欸，乍一看不是很简单嘛，以`posts/`为例

```sh
git add . && git commit -m "Save local changes before update"
# 合并上游仓库，有冲突完全使用上游仓库的
git pull upstream main --strategy-option theirs 
git checkout HEAD -- posts/
```

理想很美好，现实很残酷。他不给！！
